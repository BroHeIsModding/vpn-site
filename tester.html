<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Discord OAuth Tester</title>
</head>
<body style="font-family: Arial, sans-serif; padding: 50px;">

<h1>Discord OAuth Tester</h1>

<p><b>1. Login with Discord:</b></p>

<button id="loginButton">Login with Discord</button>

<br><br>

<p><b>2. Response:</b></p>
<pre id="result" style="background: #eee; padding: 10px;"></pre>

<script>
const clientId = '1283074346918744175'; // Your real client ID
const redirectUri = 'https://broheismodding.github.io/vpn-site/tester.html'; // Your redirect URI
const backendUrl = 'https://vpn-backend-plum.vercel.app'; // Your Vercel backend URL

const loginButton = document.getElementById('loginButton');
const resultBox = document.getElementById('result');

loginButton.onclick = () => {
  const url = `https://discord.com/oauth2/authorize?client_id=${clientId}&redirect_uri=${encodeURIComponent(redirectUri)}&response_type=code&scope=identify`;
  window.location.href = url;
};

const urlParams = new URLSearchParams(window.location.search);
const code = urlParams.get('code');

if (code) {
  resultBox.innerText = 'Exchanging code for access token...';

  fetch(`${backendUrl}/api/oauth/callback?code=${code}`)
    .then(res => res.json())
    .then(data => {
      if (data.error) {
        resultBox.innerText = '❌ ERROR: ' + JSON.stringify(data, null, 2);
      } else {
        resultBox.innerText = '✅ SUCCESS: ' + JSON.stringify(data, null, 2);
      }
      window.history.replaceState({}, document.title, redirectUri);
    })
    .catch(err => {
      resultBox.innerText = '❌ FETCH ERROR: ' + err.message;
    });
}
</script>

</body>
</html>
